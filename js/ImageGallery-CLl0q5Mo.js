import{j as i}from"./index-CPbXuNxo.js";import{R as L,r as u}from"./vendor-DaLL37dA.js";import{c as ee}from"./gallery-BsZh0IYC.js";function te(t,n){if(t==null)return{};var e=ne(t,n),s,l;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(l=0;l<c.length;l++)s=c[l],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(e[s]=t[s])}return e}function ne(t,n){if(t==null)return{};var e={},s=Object.keys(t),l,c;for(c=0;c<s.length;c++)l=s[c],!(n.indexOf(l)>=0)&&(e[l]=t[l]);return e}function P(){return P=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},P.apply(this,arguments)}function G(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);n&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(t,l).enumerable})),e.push.apply(e,s)}return e}function N(t){for(var n=1;n<arguments.length;n++){var e=arguments[n]!=null?arguments[n]:{};n%2?G(Object(e),!0).forEach(function(s){se(t,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):G(Object(e)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(e,s))})}return t}function se(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}const re={breakpointCols:void 0,className:void 0,columnClassName:void 0,children:void 0,columnAttrs:void 0,column:void 0},z=2;class $ extends L.Component{constructor(n){super(n),this.reCalculateColumnCount=this.reCalculateColumnCount.bind(this),this.reCalculateColumnCountDebounce=this.reCalculateColumnCountDebounce.bind(this);let e;this.props.breakpointCols&&this.props.breakpointCols.default?e=this.props.breakpointCols.default:e=parseInt(this.props.breakpointCols)||z,this.state={columnCount:e}}componentDidMount(){this.reCalculateColumnCount(),window&&window.addEventListener("resize",this.reCalculateColumnCountDebounce)}componentDidUpdate(){this.reCalculateColumnCount()}componentWillUnmount(){window&&window.removeEventListener("resize",this.reCalculateColumnCountDebounce)}reCalculateColumnCountDebounce(){if(!window||!window.requestAnimationFrame){this.reCalculateColumnCount();return}window.cancelAnimationFrame&&window.cancelAnimationFrame(this._lastRecalculateAnimationFrame),this._lastRecalculateAnimationFrame=window.requestAnimationFrame(()=>{this.reCalculateColumnCount()})}reCalculateColumnCount(){const n=window&&window.innerWidth||1/0;let e=this.props.breakpointCols;typeof e!="object"&&(e={default:parseInt(e)||z});let s=1/0,l=e.default||z;for(let c in e){const g=parseInt(c);g>0&&n<=g&&g<s&&(s=g,l=e[c])}l=Math.max(1,parseInt(l)||1),this.state.columnCount!==l&&this.setState({columnCount:l})}itemsInColumns(){const n=this.state.columnCount,e=new Array(n),s=L.Children.toArray(this.props.children);for(let l=0;l<s.length;l++){const c=l%n;e[c]||(e[c]=[]),e[c].push(s[l])}return e}renderColumns(){const{column:n,columnAttrs:e={},columnClassName:s}=this.props,l=this.itemsInColumns(),c=`${100/l.length}%`;let g=s;g&&typeof g!="string"&&(this.logDeprecated('The property "columnClassName" requires a string'),typeof g=="undefined"&&(g="my-masonry-grid_column"));const p=N(N(N({},n),e),{},{style:N(N({},e.style),{},{width:c}),className:g});return l.map((m,f)=>L.createElement("div",P({},p,{key:f}),m))}logDeprecated(n){console.error("[Masonry]",n)}render(){const n=this.props,{children:e,breakpointCols:s,columnClassName:l,columnAttrs:c,column:g,className:p}=n,m=te(n,["children","breakpointCols","columnClassName","columnAttrs","column","className"]);let f=p;return typeof p!="string"&&(this.logDeprecated('The property "className" requires a string'),typeof p=="undefined"&&(f="my-masonry-grid")),L.createElement("div",P({},m,{className:f}),this.renderColumns())}}$.defaultProps=re;function le({categories:t,activeCategory:n,onCategoryChange:e}){const[s,l]=u.useState(0),c=u.useRef(null),g=u.useRef([]);u.useEffect(()=>{const m=t.findIndex(f=>f.id===n);m!==-1&&l(m)},[n,t]),u.useEffect(()=>{if(g.current[s]&&c.current){const m=g.current[s],f=c.current;if(f.scrollWidth>f.clientWidth){const y=m.offsetLeft,R=m.offsetWidth,I=f.clientWidth,b=y-I/2+R/2;f.scrollTo({left:b,behavior:"smooth"})}}},[s]);const p=(m,f)=>{l(f),e(m.id)};return i.jsx("div",{className:"category-toggle",children:i.jsx("div",{className:"category-toggle-container",ref:c,children:t.map((m,f)=>i.jsxs("button",{ref:y=>g.current[f]=y,className:`category-button ${f===s?"active":""}`,onClick:()=>p(m,f),"aria-label":`Visa ${m.name} (${m.images.length} bilder)`,children:[i.jsx("span",{className:"category-name",children:m.name}),i.jsxs("span",{className:"category-count",children:["(",m.images.length,")"]})]},m.id))})})}const ie=[{id:"alla",name:"Alla bilder",description:"Alla bilder från Storegården 7",images:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]},{id:"evenemang",name:"Evenemang",description:"Evenemang från Storegården 7",images:[2,4,6,8,10,12,14]},{id:"konst-keramik",name:"Konst & Keramik",description:"Konst och keramik från Storegården 7",images:[16,18,19,20]},{id:"lokal",name:"Lokal",description:"Lokal bilder från Storegården 7",images:[1,3,5,7,9,11,13,15,17]}],j={categories:ie};function ue(){const[t,n]=u.useState("alla"),[e,s]=u.useState(!1),[l,c]=u.useState(!1),[g,p]=u.useState(!1),[m,f]=u.useState(0),[y,R]=u.useState("hidden"),I=u.useRef("hidden"),b=u.useCallback(r=>{I.current!==r&&(I.current=r,R(r))},[]),A=u.useRef(null),J=u.useRef(null),S=(r,o)=>{if(o==="alla"){for(const a of j.categories)if(a.id!=="alla"&&a.images.includes(r))return`/images/${a.id}/slide${r}.jpg`;return`/images/slides/slide${r}.jpg`}return`/images/${o}/slide${r}.jpg`},F=r=>({alt:"Bild från Storegården 7",title:`Bild ${r}`,description:`Bild ${r} från Storegården 7`}),q=u.useMemo(()=>{const r=new Set;return j.categories.forEach(a=>{a.id!=="alla"&&a.images.forEach(d=>r.add(d))}),Array.from(r).sort((a,d)=>a-d).map(a=>{const d=F(a);return{original:S(a,"alla"),thumbnail:S(a,"alla"),description:d.description,originalAlt:d.alt,thumbnailAlt:d.title,imageNumber:a}})},[]),w=u.useMemo(()=>{const r=j.categories.find(o=>o.id===t);return!r||t==="alla"?q:r.images.map(o=>{const a=F(o);return{original:S(o,t),thumbnail:S(o,t),description:a.description,originalAlt:a.alt,thumbnailAlt:a.title,imageNumber:o}})},[t,q]),K=u.useCallback(()=>{c(!l)},[l]),E=u.useCallback(r=>{f(r),p(!0)},[]),Q=u.useCallback(r=>{s(!0),n(r),c(!1),p(!1),setTimeout(()=>{s(!1)},300)},[]),X=u.useCallback(()=>{p(!1)},[]);u.useEffect(()=>{if(!l){b("hidden");return}const r=A.current;if(!r)return;let o=!1;const a=8,d=C=>{let h=0,x=C;for(;x;)h+=x.offsetTop||0,x=x.offsetParent;return h};let T=!1,M=!1;const W=r.querySelector(".sentinel-top"),_=r.querySelector(".sentinel-bottom");let k;"IntersectionObserver"in window&&W&&_&&(k=new IntersectionObserver(C=>{if(C.forEach(h=>{h.target===W&&(T=h.isIntersecting),h.target===_&&(M=h.isIntersecting)}),!T&&!M){const h=d(r),x=h+r.offsetHeight,O=window.scrollY||window.pageYOffset;if(O+(window.innerHeight||document.documentElement.clientHeight)<h||O>=x){b("hidden");return}}M?b("bottom"):T&&b("fixed")},{root:null,threshold:0}),k.observe(W),k.observe(_));const v=()=>{if(!A.current)return;const C=A.current,h=d(C),x=C.offsetHeight,O=h+x,H=window.scrollY||window.pageYOffset,Z=window.innerHeight||document.documentElement.clientHeight,V=H+Z;if(V<h){b("hidden");return}if(H>=O){b("hidden");return}if(V>=O-a){b("bottom");return}b("fixed")},Y=()=>{o||(o=!0,requestAnimationFrame(()=>{v(),o=!1}))},U=()=>v();let D;return window.ResizeObserver&&(D=new ResizeObserver(()=>v()),D.observe(r)),r.querySelectorAll("img").forEach(C=>{C.complete||C.addEventListener("load",v,{once:!0})}),setTimeout(v,50),setTimeout(v,200),setTimeout(v,600),v(),window.addEventListener("scroll",Y,{passive:!0}),window.addEventListener("resize",U),()=>{window.removeEventListener("scroll",Y),window.removeEventListener("resize",U),D&&D.disconnect(),k&&k.disconnect()}},[l,b]);const B={default:3,768:2,480:1};return i.jsxs("div",{className:"storegarden-gallery",children:[i.jsx("h2",{id:"gallery-heading",children:"Bildgalleri"}),i.jsx(le,{categories:j.categories,activeCategory:t,onCategoryChange:Q}),e?i.jsx($,{breakpointCols:B,className:"gallery-grid",columnClassName:"gallery-column",children:[...Array(6)].map((r,o)=>i.jsx("div",{className:"gallery-thumbnail skeleton-item",children:i.jsx("div",{className:"skeleton-image",style:{height:`${200+o%3*50}px`}})},o))}):i.jsx($,{breakpointCols:B,className:"gallery-grid",columnClassName:"gallery-column",children:w.slice(0,6).map((r,o)=>{var a;return i.jsxs("div",{className:"gallery-thumbnail",onClick:()=>E(o),role:"button",tabIndex:0,"aria-label":`Öppna bild ${o+1} av ${w.length} i lightbox`,onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),E(o))},children:[i.jsx("img",{src:r.thumbnail,alt:r.thumbnailAlt,loading:"eager"}),i.jsxs("div",{className:"image-overlay",children:[i.jsx("span",{className:"image-category",children:((a=j.categories.find(d=>d.id===t))==null?void 0:a.name)||"Alla"}),i.jsxs("span",{className:"image-number",children:["#",r.imageNumber]})]})]},o)})}),!l&&i.jsxs("button",{className:"show-more-button",onClick:K,"aria-expanded":l,"aria-controls":"expanded-gallery","aria-label":`Visa alla ${w.length} bilder i galleriet`,children:["Visa alla bilder (",w.length,")"]}),l&&i.jsxs("div",{className:"expanded-gallery-container",ref:A,children:[i.jsx("div",{className:"gallery-sentinel sentinel-top","aria-hidden":"true"}),i.jsx($,{breakpointCols:B,className:"gallery-grid expanded-grid",columnClassName:"gallery-column",id:"expanded-gallery",children:w.slice(6).map((r,o)=>{var a;return i.jsxs("div",{className:"gallery-thumbnail",onClick:()=>E(o+6),role:"button",tabIndex:0,"aria-label":`Öppna bild ${o+7} av ${w.length} i lightbox`,onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),E(o+6))},children:[i.jsx("img",{src:r.thumbnail,alt:r.thumbnailAlt,loading:"lazy"}),i.jsxs("div",{className:"image-overlay",children:[i.jsx("span",{className:"image-category",children:((a=j.categories.find(d=>d.id===t))==null?void 0:a.name)||"Alla"}),i.jsxs("span",{className:"image-number",children:["#",r.imageNumber]})]})]},o+6)})}),i.jsx("div",{className:"gallery-sentinel sentinel-bottom","aria-hidden":"true"}),i.jsx("button",{ref:J,className:`hide-images-button ${y==="fixed"?"is-fixed":""} ${y==="bottom"?"at-bottom":""} ${y==="hidden"?"is-hidden":""}`,onClick:K,"aria-label":"Dölj utökade galleri bilder","aria-hidden":y==="hidden",children:"Dölj bilder"})]}),g&&i.jsx("div",{className:"gallery-modal",role:"dialog","aria-modal":"true","aria-labelledby":"gallery-heading","aria-describedby":"gallery-description",children:i.jsxs("div",{className:"gallery-modal-content",children:[i.jsxs("div",{id:"gallery-description",className:"sr-only",children:["Bildgalleri med ",w.length," bilder. Använd pilknapparna för att navigera, ESC för att stänga."]}),i.jsx("button",{className:"gallery-close-button",onClick:X,"aria-label":"Stäng bildgalleri",title:"Stäng lightbox (ESC)",children:"×"}),i.jsx(ee,{items:w,startIndex:m,showThumbnails:!0,showFullscreenButton:!0,showPlayButton:!1,showIndex:!0,showBullets:!1,infinite:!0,slideDuration:300,slideInterval:2e3})]})})]})}export{ue as default};
